<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Android 自定义控件 仿支付宝芝麻信用的刻度盘</title>
    <meta name="description" content="  一、前言一、前言  最近在看芝麻信用的时候突发奇想自己做一个芝麻信用的界面然后可以用来装装逼，可惜的是把支付宝解开来没发现相关的界面图片，虽然是这样但也不影响到咱的动手能力，好了，进入正题。">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4001/2017/02/19/Android-Custom-View-SesameCredit/">
    <link rel="alternate" type="application/rss+xml" title="cekiasoo's blog" href="http://localhost:4001/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?44057784c9cb1a12f1f7fcb6ae5c0237";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>



</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">cekiasoo's blog</a>
        <small>Android Coder</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>Android 自定义控件 仿支付宝芝麻信用的刻度盘</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2017-02-19
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>cekiasoo
                
            </div>
            <div class="label-card">
                <p>阅读：<span id="busuanzi_value_page_pv"></span></p>
            </div>
            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Android开发" title="Category: Android开发" rel="category">Android开发</a>&nbsp;
    
        <a href="/category/#Android自定义控件" title="Category: Android自定义控件" rel="category">Android自定义控件</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#Android" title="Tag: Android" rel="tag">Android</a-->
        <a href="/tag/#Android" title="Tag: Android" rel="tag">Android</a>&nbsp;
    
        <!--a href="/tag/#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6" title="Tag: 自定义控件" rel="tag">自定义控件</a-->
        <a href="/tag/#自定义控件" title="Tag: 自定义控件" rel="tag">自定义控件</a>&nbsp;
    
        <!--a href="/tag/#%E5%88%BB%E5%BA%A6%E7%9B%98" title="Tag: 刻度盘" rel="tag">刻度盘</a-->
        <a href="/tag/#刻度盘" title="Tag: 刻度盘" rel="tag">刻度盘</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#一前言" id="markdown-toc-一前言">一、前言</a></li>
  <li><a href="#二分析" id="markdown-toc-二分析">二、分析</a></li>
  <li><a href="#三效果" id="markdown-toc-三效果">三、效果</a></li>
  <li><a href="#四实现" id="markdown-toc-四实现">四、实现</a>    <ul>
      <li><a href="#一自定义属性" id="markdown-toc-一自定义属性">（一）自定义属性</a></li>
      <li><a href="#二解析属性" id="markdown-toc-二解析属性">（二）解析属性</a></li>
      <li><a href="#三覆盖onmeasure方法修改下宽度或高度" id="markdown-toc-三覆盖onmeasure方法修改下宽度或高度">（三）覆盖onMeasure()方法修改下宽度或高度</a></li>
      <li><a href="#四ondraw" id="markdown-toc-四ondraw">（四）onDraw()</a></li>
      <li><a href="#五完整的代码" id="markdown-toc-五完整的代码">（五）完整的代码</a></li>
    </ul>
  </li>
  <li><a href="#五使用" id="markdown-toc-五使用">五、使用</a>    <ul>
      <li><a href="#一布局" id="markdown-toc-一布局">（一）布局</a></li>
      <li><a href="#二activity" id="markdown-toc-二activity">（二）Activity</a></li>
    </ul>
  </li>
</ul>

<h2 id="一前言">一、前言</h2>

<blockquote>
  <p>最近在看芝麻信用的时候突发奇想自己做一个芝麻信用的界面然后可以用来装装逼，可惜的是把支付宝解开来没发现相关的界面图片，虽然是这样但也不影响到咱的动手能力，好了，进入正题。</p>
</blockquote>

<h2 id="二分析">二、分析</h2>

<blockquote>
  <p>来看看芝麻信用的界面先。<br />
<img src="/images/Android Custom View SesameCredit/a.jpg" alt="运行结果截图" /><br /></p>
</blockquote>

<blockquote>
  <p>可以看到有一个外面有个圆弧，前面一段是渐变的，后面一段颜色浅一些没有渐变的，没有渐变的在渐变的底下，圆弧上还有个小圆点，我们放大圆点这里再看，
<img src="/images/Android Custom View SesameCredit/QQ截图20170219222115.png" alt="运行结果截图" /><br /></p>
</blockquote>

<blockquote>
  <p>其实这个圆点应该是用张图片来做的。</p>
</blockquote>

<blockquote>
  <p>里面是个由一个点一个点组成的圆弧，从上面的放大图也可以看出这不是圆点而是像小矩形的点，总共有56个点，已走过的点比未走过的点的颜色要深。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170221001627.jpg" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>这张图是上个版本的芝麻信用的刻度盘，可以看出这个盘如果是圆形的话，大刻度的就是分为8份，每一份就是45度，这里有5份，所以这个盘为225度，现在的版本应该也是一样225度，在这个版本可以看出分数是从350开始到950，350到550为一个大刻度，每一分就是0.225°；550到600为一个大刻度，600到650为一个大刻度，650到700为一个大刻度，这三个间隔是相同的，就是550到700的每一分是0.9°；700到950为一个大刻度，每一分占0.18°。</p>
</blockquote>

<blockquote>
  <p>接下来还有个小指针，再里面就是文字了，</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170221004250.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>用ps开启网格看下，文字的位置就很清楚了。</p>
</blockquote>

<h2 id="三效果">三、效果</h2>

<blockquote>
  <p>来看看实现后的效果先。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170221213448.png" alt="运行结果截图" /><br /></p>

<h2 id="四实现">四、实现</h2>

<h4 id="一自定义属性">（一）自定义属性</h4>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
    <span class="c">&lt;!--刻度圆弧半径--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"scaleArcRadius"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--刻度圆弧的宽度--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"scaleArcWidth"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--进度圆弧的半径--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"progressArcRadius"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--进度圆弧的宽度--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"progressArcWidth"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--BETA的字体大小--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"betaTextSize"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--信用级别的字体大小--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"creditLevelTextSize"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--信用分数的字体大小--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"creditScoreTextSize"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--评估时间的字体大小--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"evaluationTimeTextSize"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--字上下行之间的间隔--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"textSpacing"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--箭头与圆弧的间隔--&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"arrowSpacing"</span> <span class="na">format=</span><span class="s">"dimension"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"DialView"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"scaleArcRadius"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"scaleArcWidth"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"progressArcRadius"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"progressArcWidth"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"betaTextSize"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"creditLevelTextSize"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"creditScoreTextSize"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"evaluationTimeTextSize"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"textSpacing"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"arrowSpacing"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre>
</div>

<h4 id="二解析属性">（二）解析属性</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DialView</span> <span class="kd">extends</span> <span class="n">View</span> <span class="o">{</span>
    <span class="cm">/**
     * 圆弧的度数
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">float</span> <span class="n">TOTAL_ANGLE</span> <span class="o">=</span> <span class="mf">225.0f</span><span class="o">;</span>
    <span class="cm">/**
     * 刻度圆弧有56个点
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">SCALE_COUNT</span> <span class="o">=</span> <span class="mi">56</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CREDIT_LEVEL</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="s">"信用较差"</span><span class="o">,</span> <span class="s">"信用中等"</span><span class="o">,</span> <span class="s">"信用良好"</span><span class="o">,</span> <span class="s">"信用优秀"</span><span class="o">,</span> <span class="s">"信用极好"</span><span class="o">};</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">BETA</span> <span class="o">=</span> <span class="s">"BETA"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EVALUATION_TIME</span> <span class="o">=</span> <span class="s">"评估时间:"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">MIN_ALPHA</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">MAX_ALPHA</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">RED</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">COLOR_TRANSPARENT</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">argb</span><span class="o">(</span><span class="n">MIN_ALPHA</span><span class="o">,</span> <span class="n">RED</span><span class="o">,</span> <span class="n">GREEN</span><span class="o">,</span> <span class="n">BLUE</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">COLOR_WHITE</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">argb</span><span class="o">(</span><span class="n">MAX_ALPHA</span><span class="o">,</span> <span class="n">RED</span><span class="o">,</span> <span class="n">GREEN</span><span class="o">,</span> <span class="n">BLUE</span><span class="o">);</span>
    <span class="cm">/**
     * 渐变进度圆弧的颜色
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">GRADIENT_COLORS</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="n">COLOR_TRANSPARENT</span><span class="o">,</span> <span class="n">COLOR_TRANSPARENT</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">};</span>
    <span class="cm">/**
     * 画笔
     */</span>
    <span class="kd">private</span> <span class="n">Paint</span> <span class="n">mPaint</span><span class="o">;</span>
    <span class="cm">/**
     * 刻度圆弧的半径
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mScaleArcRadius</span><span class="o">;</span>
    <span class="cm">/**
     * 刻度圆弧的宽度
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mScaleArcWidth</span><span class="o">;</span>
    <span class="cm">/**
     * 进度圆弧的半径
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mProgressArcRadius</span><span class="o">;</span>
    <span class="cm">/**
     * 进度圆弧的宽度
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mProgressArcWidth</span><span class="o">;</span>
    <span class="cm">/**
     * 进度圆弧上的小圆点的半径
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mBallOverstepWidth</span><span class="o">;</span>
    <span class="cm">/**
     * BETA的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mBetaTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 信用级别的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCreditLevelTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 信用分数的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCreditScoreTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 评估时间的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mEvaluationTimeTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 字上下行的间隔
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mTextSpacing</span><span class="o">;</span>
    <span class="cm">/**
     * 箭头与圆弧的间隔
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mArrowSpacing</span><span class="o">;</span>
    <span class="cm">/**
     * 信用分数
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCreditScore</span> <span class="o">=</span> <span class="mi">666</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">DialView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">DialView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">DialView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
        <span class="n">parseAttr</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
        <span class="n">mPaint</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Paint</span><span class="o">();</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setAntiAlias</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setDither</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 解析属性
     *
     * @param context      Context
     * @param attrs        AttributeSet
     * @param defStyleAttr defStyleAttr
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">parseAttr</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TypedArray</span> <span class="n">_TypedArray</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">obtainStyledAttributes</span><span class="o">(</span><span class="n">attrs</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">mScaleArcRadius</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_scaleArcRadius</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">100</span><span class="o">));</span>
        <span class="n">mScaleArcWidth</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_scaleArcWidth</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">2</span><span class="o">));</span>
        <span class="n">mProgressArcRadius</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_progressArcRadius</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">105</span><span class="o">));</span>
        <span class="n">mProgressArcWidth</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_progressArcWidth</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">1</span><span class="o">));</span>
        <span class="n">mBetaTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_betaTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
        <span class="n">mCreditLevelTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_creditLevelTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">18</span><span class="o">));</span>
        <span class="n">mCreditScoreTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_creditScoreTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">40</span><span class="o">));</span>
        <span class="n">mEvaluationTimeTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_evaluationTimeTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
        <span class="n">mTextSpacing</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_textSpacing</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
        <span class="n">mArrowSpacing</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_arrowSpacing</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">5</span><span class="o">));</span>
        <span class="n">_TypedArray</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * dp转px
     * @param pContext Context
     * @param pDpVal dp值
     * @return px值
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">dp2px</span><span class="o">(</span><span class="n">Context</span> <span class="n">pContext</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pDpVal</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">_Scale</span> <span class="o">=</span> <span class="n">pContext</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getDisplayMetrics</span><span class="o">().</span><span class="na">density</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">pDpVal</span> <span class="o">*</span> <span class="n">_Scale</span> <span class="o">+</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="o">(</span><span class="n">pDpVal</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre>
</div>

<h4 id="三覆盖onmeasure方法修改下宽度或高度">（三）覆盖onMeasure()方法修改下宽度或高度</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onMeasure</span><span class="o">(</span><span class="kt">int</span> <span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="kt">int</span> <span class="n">heightMeasureSpec</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">_WidthMode</span><span class="o">=</span><span class="n">MeasureSpec</span><span class="o">.</span><span class="na">getMode</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">_HeightMode</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">getMode</span><span class="o">(</span><span class="n">heightMeasureSpec</span><span class="o">);</span>
        <span class="n">Bitmap</span> <span class="n">_Ball</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_ball</span><span class="o">);</span>
        <span class="n">mBallOverstepWidth</span> <span class="o">=(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">_Ball</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">_WidthMode</span> <span class="o">!=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">_Width</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">mScaleArcRadius</span><span class="o">,</span> <span class="n">mProgressArcRadius</span><span class="o">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">mBallOverstepWidth</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="o">+</span> <span class="n">getPaddingLeft</span><span class="o">()</span> <span class="o">+</span> <span class="n">getPaddingRight</span><span class="o">();</span>
            <span class="n">widthMeasureSpec</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">makeMeasureSpec</span><span class="o">(</span><span class="n">_Width</span><span class="o">,</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">_HeightMode</span> <span class="o">!=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">_MaxRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">mScaleArcRadius</span><span class="o">,</span> <span class="n">mProgressArcRadius</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">_Height</span> <span class="o">=(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">_MaxRadius</span> <span class="o">+</span> <span class="n">_MaxRadius</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="na">sin</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">toRadians</span><span class="o">(</span><span class="mf">22.5</span><span class="o">))</span>
                    <span class="o">+</span> <span class="n">mBallOverstepWidth</span> <span class="o">+</span> <span class="n">_Ball</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">getPaddingTop</span><span class="o">()</span> <span class="o">+</span> <span class="n">getPaddingBottom</span><span class="o">());</span>
            <span class="n">heightMeasureSpec</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">makeMeasureSpec</span><span class="o">(</span><span class="n">_Height</span><span class="o">,</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onMeasure</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="n">heightMeasureSpec</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>如果是EXACTLY模式，我们就不需要处理了，其他情况我们就需要重新计算下宽度或高度，高度的计算也简单，主要是下边的部分的计算，下图绿色那条边所对的角是22.5°，深蓝色那条边是圆的半径了，所对的角是90°，这就是三角函数的知识了。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/2017-2-21205624.jpg" alt="运行结果截图" /><br /></p>

<h4 id="四ondraw">（四）onDraw()</h4>

<blockquote>
  <p>1.onDraw()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDraw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">_MaxRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">mProgressArcRadius</span><span class="o">,</span> <span class="n">mScaleArcRadius</span><span class="o">);</span>
        <span class="c1">//移动原点到中心位置</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">translate</span><span class="o">(</span><span class="n">_MaxRadius</span> <span class="o">+</span> <span class="n">mBallOverstepWidth</span><span class="o">,</span> <span class="n">_MaxRadius</span> <span class="o">+</span> <span class="n">mBallOverstepWidth</span><span class="o">);</span>
        <span class="n">drawProgressArc</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>                <span class="c1">//画底层圆弧</span>
        <span class="n">drawGradientProgressArc</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>        <span class="c1">//画渐变的进度画弧</span>
        <span class="n">drawProgressArcBall</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>            <span class="c1">//画进度圆弧上的小球</span>
        <span class="n">drawScaleArc</span><span class="o">(</span><span class="n">canvas</span><span class="o">,</span> <span class="mi">80</span><span class="o">,</span> <span class="n">SCALE_COUNT</span><span class="o">);</span>  <span class="c1">//画刻度圆弧</span>
        <span class="n">drawArrow</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>                      <span class="c1">//画箭头</span>
        <span class="n">drawText</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>                       <span class="c1">//画文字</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>这里把坐标原点移动到中心位置，位置如下图，接下来就方便画一系列东西。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/2017-2-20211117.jpg" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>2.drawProgressArc()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 画底层圆弧
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawProgressArc</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">mProgressArcWidth</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite2</span><span class="o">));</span>
        <span class="kt">float</span> <span class="n">_ProgressArcL</span> <span class="o">=</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">;</span>
        <span class="n">RectF</span> <span class="n">_ProgressArcRectF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RectF</span><span class="o">(-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="o">-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawArc</span><span class="o">(</span><span class="n">_ProgressArcRectF</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">TOTAL_ANGLE</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>画外面一层浅颜色的圆弧，为了方便计算我们先旋转一下画布，逆时针旋转202.5度，这样起点的位置就是0度了，接着就是根据圆弧的半径画个圆弧了。</p>
</blockquote>

<blockquote>
  <p>现在的效果。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170220221229.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>3.drawGradientProgressArc()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 画渐变的进度画弧
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawGradientProgressArc</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">mProgressArcWidth</span><span class="o">);</span>
        <span class="n">SweepGradient</span> <span class="n">_Shader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SweepGradient</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">GRADIENT_COLORS</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setShader</span><span class="o">(</span><span class="n">_Shader</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite1</span><span class="o">));</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_ProgressArcL</span> <span class="o">=</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">;</span>
        <span class="n">RectF</span> <span class="n">_ProgressArcRectF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RectF</span><span class="o">(-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="o">-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawArc</span><span class="o">(</span><span class="n">_ProgressArcRectF</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_TargetAngle</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setShader</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="mf">22.5f</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>现在画上面一层渐变的圆弧，同样的旋转一下画布，毕竟画法和drawProgressArc()是一样的，不过要设置渐变效果，渐变用的是梯度渲染SweepGradient，还有计算出当前分数所对占圆弧的角度，因为画到那个角度为止就好了。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170220221114.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>4.drawProgressArcBall()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 画进度圆弧上的小球
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawProgressArcBall</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">_TargetAngle</span> <span class="o">-</span> <span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">FILL</span><span class="o">);</span>
        <span class="n">Bitmap</span> <span class="n">_Ball</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_ball</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">_Ball</span><span class="o">,</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">_Ball</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Ball</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>画圆弧上的小球，这时我们要把画布旋转到x轴正方向到目标位置（画小球的地方）那，因为本来起点到x轴正方向是202.5度，所以使用起点到目标位置的度数减去202.5度就是要旋转的度数了，现在小球的位置x和y就好计算了，那个小球是我自己p的，由于ps术太差，p出来不太像。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170220225324.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>5.drawScaleArc()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 画刻度圆弧
     * @param canvas Canvas
     * @param pAlpha 没有到达的透明度 0~255
     * @param pCount 点的个数
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawScaleArc</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pAlpha</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite3</span><span class="o">));</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">mScaleArcWidth</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_ScaleArcL</span> <span class="o">=</span> <span class="n">mScaleArcRadius</span> <span class="o">-</span> <span class="n">mScaleArcWidth</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">;</span>
        <span class="n">RectF</span> <span class="n">_ScaleArcRectF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RectF</span><span class="o">(-</span><span class="n">_ScaleArcL</span><span class="o">,</span> <span class="o">-</span><span class="n">_ScaleArcL</span><span class="o">,</span> <span class="n">_ScaleArcL</span><span class="o">,</span> <span class="n">_ScaleArcL</span><span class="o">);</span>
        <span class="c1">//画完每个刻度所要旋转的度数</span>
        <span class="kt">float</span> <span class="n">_DialSpacing</span> <span class="o">=</span> <span class="o">(</span><span class="n">TOTAL_ANGLE</span> <span class="o">-</span> <span class="n">pCount</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">pCount</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_CurrentAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">_SetAlpha</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">_CurrentAngle</span> <span class="o">&gt;</span> <span class="n">_TargetAngle</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">_SetAlpha</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//设置未达到的点的透明度</span>
                <span class="n">mPaint</span><span class="o">.</span><span class="na">setAlpha</span><span class="o">(</span><span class="n">pAlpha</span><span class="o">);</span>
                <span class="n">_SetAlpha</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">canvas</span><span class="o">.</span><span class="na">drawArc</span><span class="o">(</span><span class="n">_ScaleArcRectF</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
            <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">_DialSpacing</span><span class="o">);</span>
            <span class="n">_CurrentAngle</span> <span class="o">+=</span> <span class="n">_DialSpacing</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//恢复透明度</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setAlpha</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>画里面那个一个点一个点的刻度圆弧，先逆时针旋转202.5度，计算出画完每个刻度所要旋转的度数，这里我设置每个点为一个度数的跨度，每画完每个点就旋转一下坐标轴再画下一个点，到达目标位置后就改下透明度画剩下的点。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/2017-2-20214004.jpg" alt="运行结果截图" /><br /></p>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170221000656.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>6.drawArrow()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 画箭头
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawArrow</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">_TargetAngle</span> <span class="o">-</span> <span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">FILL</span><span class="o">);</span>
        <span class="n">Bitmap</span> <span class="n">_Arrow</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_arrow</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">_MinRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">mProgressArcRadius</span><span class="o">,</span> <span class="n">mScaleArcRadius</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_Left</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">_MinRadius</span> <span class="o">==</span> <span class="n">mScaleArcRadius</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">_Left</span> <span class="o">=</span> <span class="n">mScaleArcRadius</span> <span class="o">-</span> <span class="n">mScaleArcWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">mArrowSpacing</span> <span class="o">-</span> <span class="n">_Arrow</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">_Left</span> <span class="o">=</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">mArrowSpacing</span> <span class="o">-</span> <span class="n">_Arrow</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kt">float</span> <span class="n">_Top</span> <span class="o">=</span> <span class="o">-(</span><span class="n">_Arrow</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">_Arrow</span><span class="o">,</span> <span class="n">_Left</span><span class="o">,</span> <span class="n">_Top</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>画箭头，这个和画那个圆弧上的小球差不多的，那个箭头也是我p的。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170221003225.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>7.drawText()</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 画文字
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawText</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">FILL</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite1</span><span class="o">));</span>
        <span class="c1">//信用分数</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mCreditScoreTextSize</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">_CreditScore</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">_CreditScore</span><span class="o">);</span>
        <span class="n">Rect</span> <span class="n">_Rect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rect</span><span class="o">();</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">getTextBounds</span><span class="o">(</span><span class="n">_CreditScore</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_CreditScore</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">_Rect</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_Y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">_CreditScore</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="c1">//信用级别</span>
        <span class="n">_Y</span> <span class="o">=</span> <span class="n">_Y</span> <span class="o">-</span> <span class="n">_Rect</span><span class="o">.</span><span class="na">height</span><span class="o">()</span> <span class="o">-</span> <span class="n">mTextSpacing</span><span class="o">;</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mCreditLevelTextSize</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">_CreditLevel</span> <span class="o">=</span> <span class="n">getCreditLevel</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">_CreditLevel</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">getTextBounds</span><span class="o">(</span><span class="n">_CreditLevel</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_CreditLevel</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">_Rect</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">_CreditLevel</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="c1">//BETA</span>
        <span class="n">_Y</span> <span class="o">=</span> <span class="n">_Y</span> <span class="o">-</span> <span class="n">_Rect</span><span class="o">.</span><span class="na">height</span><span class="o">()</span> <span class="o">-</span> <span class="n">mTextSpacing</span><span class="o">;</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mBetaTextSize</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setAlpha</span><span class="o">(</span><span class="mi">150</span><span class="o">);</span>
        <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">BETA</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">BETA</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="c1">//评估时间</span>
        <span class="n">String</span> <span class="n">_EvaluationTime</span> <span class="o">=</span> <span class="n">EVALUATION_TIME</span> <span class="o">+</span> <span class="n">getDate</span><span class="o">();</span>
        <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">_EvaluationTime</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">getTextBounds</span><span class="o">(</span><span class="n">_EvaluationTime</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_EvaluationTime</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">_Rect</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mEvaluationTimeTextSize</span><span class="o">);</span>
        <span class="n">_Y</span> <span class="o">=</span> <span class="n">mTextSpacing</span> <span class="o">+</span> <span class="n">_Rect</span><span class="o">.</span><span class="na">height</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">_EvaluationTime</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>画文字了，从分析那的图可以看出文字的位置了，从信用分数画起是最方便的了，该怎么画这个就不用我多说了。</p>
</blockquote>

<p><img src="/images/Android Custom View SesameCredit/QQ截图20170221005336.png" alt="运行结果截图" /><br /></p>

<blockquote>
  <p>8.几个辅助方法</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 根据信用分数计算出目标角度
     * @param pCreditScore 信用分数
     * @return 目标角度
     */</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="nf">getTargetAngle</span><span class="o">(</span><span class="kt">float</span> <span class="n">pCreditScore</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="mi">180</span> <span class="o">+</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">-</span> <span class="mi">700</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.18f</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;</span> <span class="mi">550</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="mi">45</span> <span class="o">+</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">-</span> <span class="mi">550</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.9f</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">-</span> <span class="mi">350</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.225f</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>在分析那有分析过了每个阶段的每一分所占的度数。</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 根据信用分数获取信用级别
     * @param pCreditScore 信用分数
     * @return 信用级别
     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getCreditLevel</span><span class="o">(</span><span class="kt">int</span> <span class="n">pCreditScore</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">350</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">550</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">550</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">600</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">650</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">650</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">700</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;=</span> <span class="mi">950</span><span class="o">){</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">4</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>看分析那上个版本的支付宝的芝麻信用的图。</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * 获取yyyy-MM-dd格式的日期
     * @return yyyy-MM-dd
     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">SimpleDateFormat</span> <span class="n">_DateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">_DateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>用在评估时间那的日期。</p>
</blockquote>

<h4 id="五完整的代码">（五）完整的代码</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ce</span><span class="o">.</span><span class="na">sesamecredit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.res.TypedArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.BitmapFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Canvas</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Color</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Paint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Rect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.RectF</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.SweepGradient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.AttributeSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DialView</span> <span class="kd">extends</span> <span class="n">View</span> <span class="o">{</span>
    <span class="cm">/**
     * 圆弧的度数
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">float</span> <span class="n">TOTAL_ANGLE</span> <span class="o">=</span> <span class="mf">225.0f</span><span class="o">;</span>
    <span class="cm">/**
     * 刻度圆弧有56个点
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">SCALE_COUNT</span> <span class="o">=</span> <span class="mi">56</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CREDIT_LEVEL</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="s">"信用较差"</span><span class="o">,</span> <span class="s">"信用中等"</span><span class="o">,</span> <span class="s">"信用良好"</span><span class="o">,</span> <span class="s">"信用优秀"</span><span class="o">,</span> <span class="s">"信用极好"</span><span class="o">};</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">BETA</span> <span class="o">=</span> <span class="s">"BETA"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EVALUATION_TIME</span> <span class="o">=</span> <span class="s">"评估时间:"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">MIN_ALPHA</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">MAX_ALPHA</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">RED</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">255</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">COLOR_TRANSPARENT</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">argb</span><span class="o">(</span><span class="n">MIN_ALPHA</span><span class="o">,</span> <span class="n">RED</span><span class="o">,</span> <span class="n">GREEN</span><span class="o">,</span> <span class="n">BLUE</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">COLOR_WHITE</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">argb</span><span class="o">(</span><span class="n">MAX_ALPHA</span><span class="o">,</span> <span class="n">RED</span><span class="o">,</span> <span class="n">GREEN</span><span class="o">,</span> <span class="n">BLUE</span><span class="o">);</span>
    <span class="cm">/**
     * 渐变进度圆弧的颜色
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">GRADIENT_COLORS</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="n">COLOR_TRANSPARENT</span><span class="o">,</span> <span class="n">COLOR_TRANSPARENT</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">,</span> <span class="n">COLOR_WHITE</span><span class="o">};</span>
    <span class="cm">/**
     * 画笔
     */</span>
    <span class="kd">private</span> <span class="n">Paint</span> <span class="n">mPaint</span><span class="o">;</span>
    <span class="cm">/**
     * 刻度圆弧的半径
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mScaleArcRadius</span><span class="o">;</span>
    <span class="cm">/**
     * 刻度圆弧的宽度
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mScaleArcWidth</span><span class="o">;</span>
    <span class="cm">/**
     * 进度圆弧的半径
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mProgressArcRadius</span><span class="o">;</span>
    <span class="cm">/**
     * 进度圆弧的宽度
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mProgressArcWidth</span><span class="o">;</span>
    <span class="cm">/**
     * 进度圆弧上的小圆点的半径
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mBallOverstepWidth</span><span class="o">;</span>
    <span class="cm">/**
     * BETA的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mBetaTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 信用级别的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCreditLevelTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 信用分数的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCreditScoreTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 评估时间的字体大小
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mEvaluationTimeTextSize</span><span class="o">;</span>
    <span class="cm">/**
     * 字上下行的间隔
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mTextSpacing</span><span class="o">;</span>
    <span class="cm">/**
     * 箭头与圆弧的间隔
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mArrowSpacing</span><span class="o">;</span>
    <span class="cm">/**
     * 信用分数
     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCreditScore</span> <span class="o">=</span> <span class="mi">666</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">DialView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">DialView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">DialView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
        <span class="n">parseAttr</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
        <span class="n">mPaint</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Paint</span><span class="o">();</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setAntiAlias</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setDither</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 解析属性
     *
     * @param context      Context
     * @param attrs        AttributeSet
     * @param defStyleAttr defStyleAttr
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">parseAttr</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TypedArray</span> <span class="n">_TypedArray</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">obtainStyledAttributes</span><span class="o">(</span><span class="n">attrs</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">mScaleArcRadius</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_scaleArcRadius</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">100</span><span class="o">));</span>
        <span class="n">mScaleArcWidth</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_scaleArcWidth</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">2</span><span class="o">));</span>
        <span class="n">mProgressArcRadius</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_progressArcRadius</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">105</span><span class="o">));</span>
        <span class="n">mProgressArcWidth</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_progressArcWidth</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">1</span><span class="o">));</span>
        <span class="n">mBetaTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_betaTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
        <span class="n">mCreditLevelTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_creditLevelTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">18</span><span class="o">));</span>
        <span class="n">mCreditScoreTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_creditScoreTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">40</span><span class="o">));</span>
        <span class="n">mEvaluationTimeTextSize</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_evaluationTimeTextSize</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
        <span class="n">mTextSpacing</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_textSpacing</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
        <span class="n">mArrowSpacing</span> <span class="o">=</span> <span class="n">_TypedArray</span><span class="o">.</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">DialView_arrowSpacing</span><span class="o">,</span> <span class="n">dp2px</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">5</span><span class="o">));</span>
        <span class="n">_TypedArray</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onMeasure</span><span class="o">(</span><span class="kt">int</span> <span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="kt">int</span> <span class="n">heightMeasureSpec</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">_WidthMode</span><span class="o">=</span><span class="n">MeasureSpec</span><span class="o">.</span><span class="na">getMode</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">_HeightMode</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">getMode</span><span class="o">(</span><span class="n">heightMeasureSpec</span><span class="o">);</span>
        <span class="n">Bitmap</span> <span class="n">_Ball</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_ball</span><span class="o">);</span>
        <span class="n">mBallOverstepWidth</span> <span class="o">=(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">_Ball</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">_WidthMode</span> <span class="o">!=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">_Width</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">mScaleArcRadius</span><span class="o">,</span> <span class="n">mProgressArcRadius</span><span class="o">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">mBallOverstepWidth</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="o">+</span> <span class="n">getPaddingLeft</span><span class="o">()</span> <span class="o">+</span> <span class="n">getPaddingRight</span><span class="o">();</span>
            <span class="n">widthMeasureSpec</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">makeMeasureSpec</span><span class="o">(</span><span class="n">_Width</span><span class="o">,</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">_HeightMode</span> <span class="o">!=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">_MaxRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">mScaleArcRadius</span><span class="o">,</span> <span class="n">mProgressArcRadius</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">_Height</span> <span class="o">=(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">_MaxRadius</span> <span class="o">+</span> <span class="n">_MaxRadius</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="na">sin</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">toRadians</span><span class="o">(</span><span class="mf">22.5</span><span class="o">))</span>
                    <span class="o">+</span> <span class="n">mBallOverstepWidth</span> <span class="o">+</span> <span class="n">_Ball</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">getPaddingTop</span><span class="o">()</span> <span class="o">+</span> <span class="n">getPaddingBottom</span><span class="o">());</span>
            <span class="n">heightMeasureSpec</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">makeMeasureSpec</span><span class="o">(</span><span class="n">_Height</span><span class="o">,</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">EXACTLY</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onMeasure</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="n">heightMeasureSpec</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDraw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">_MaxRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">mProgressArcRadius</span><span class="o">,</span> <span class="n">mScaleArcRadius</span><span class="o">);</span>
        <span class="c1">//移动原点到中心位置</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">translate</span><span class="o">(</span><span class="n">_MaxRadius</span> <span class="o">+</span> <span class="n">mBallOverstepWidth</span><span class="o">,</span> <span class="n">_MaxRadius</span> <span class="o">+</span> <span class="n">mBallOverstepWidth</span><span class="o">);</span>
        <span class="n">drawProgressArc</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>                <span class="c1">//画底层圆弧</span>
        <span class="n">drawGradientProgressArc</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>        <span class="c1">//画渐变的进度画弧</span>
        <span class="n">drawProgressArcBall</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>            <span class="c1">//画进度圆弧上的小球</span>
        <span class="n">drawScaleArc</span><span class="o">(</span><span class="n">canvas</span><span class="o">,</span> <span class="mi">80</span><span class="o">,</span> <span class="n">SCALE_COUNT</span><span class="o">);</span>  <span class="c1">//画刻度圆弧</span>
        <span class="n">drawArrow</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>                      <span class="c1">//画箭头</span>
        <span class="n">drawText</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>                       <span class="c1">//画文字</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 画底层圆弧
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawProgressArc</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">mProgressArcWidth</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite2</span><span class="o">));</span>
        <span class="kt">float</span> <span class="n">_ProgressArcL</span> <span class="o">=</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">;</span>
        <span class="n">RectF</span> <span class="n">_ProgressArcRectF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RectF</span><span class="o">(-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="o">-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawArc</span><span class="o">(</span><span class="n">_ProgressArcRectF</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">TOTAL_ANGLE</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 画渐变的进度画弧
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawGradientProgressArc</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">mProgressArcWidth</span><span class="o">);</span>
        <span class="n">SweepGradient</span> <span class="n">_Shader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SweepGradient</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">GRADIENT_COLORS</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setShader</span><span class="o">(</span><span class="n">_Shader</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite1</span><span class="o">));</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_ProgressArcL</span> <span class="o">=</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">;</span>
        <span class="n">RectF</span> <span class="n">_ProgressArcRectF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RectF</span><span class="o">(-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="o">-</span><span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">,</span> <span class="n">_ProgressArcL</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawArc</span><span class="o">(</span><span class="n">_ProgressArcRectF</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_TargetAngle</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setShader</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 画进度圆弧上的小球
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawProgressArcBall</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">_TargetAngle</span> <span class="o">-</span> <span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">FILL</span><span class="o">);</span>
        <span class="n">Bitmap</span> <span class="n">_Ball</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_ball</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">_Ball</span><span class="o">,</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">_Ball</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Ball</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 画刻度圆弧
     * @param canvas Canvas
     * @param pAlpha 没有到达的透明度 0~255
     * @param pCount 点的个数
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawScaleArc</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pAlpha</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite3</span><span class="o">));</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">mScaleArcWidth</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_ScaleArcL</span> <span class="o">=</span> <span class="n">mScaleArcRadius</span> <span class="o">-</span> <span class="n">mScaleArcWidth</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">;</span>
        <span class="n">RectF</span> <span class="n">_ScaleArcRectF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RectF</span><span class="o">(-</span><span class="n">_ScaleArcL</span><span class="o">,</span> <span class="o">-</span><span class="n">_ScaleArcL</span><span class="o">,</span> <span class="n">_ScaleArcL</span><span class="o">,</span> <span class="n">_ScaleArcL</span><span class="o">);</span>
        <span class="c1">//画完每个刻度所要旋转的度数</span>
        <span class="kt">float</span> <span class="n">_DialSpacing</span> <span class="o">=</span> <span class="o">(</span><span class="n">TOTAL_ANGLE</span> <span class="o">-</span> <span class="n">pCount</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">pCount</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_CurrentAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">_SetAlpha</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">_CurrentAngle</span> <span class="o">&gt;</span> <span class="n">_TargetAngle</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">_SetAlpha</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//设置未达到的点的透明度</span>
                <span class="n">mPaint</span><span class="o">.</span><span class="na">setAlpha</span><span class="o">(</span><span class="n">pAlpha</span><span class="o">);</span>
                <span class="n">_SetAlpha</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">canvas</span><span class="o">.</span><span class="na">drawArc</span><span class="o">(</span><span class="n">_ScaleArcRectF</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
            <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">_DialSpacing</span><span class="o">);</span>
            <span class="n">_CurrentAngle</span> <span class="o">+=</span> <span class="n">_DialSpacing</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//恢复透明度</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setAlpha</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 画箭头
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawArrow</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">_TargetAngle</span> <span class="o">=</span> <span class="n">getTargetAngle</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">_TargetAngle</span> <span class="o">-</span> <span class="mf">202.5f</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">FILL</span><span class="o">);</span>
        <span class="n">Bitmap</span> <span class="n">_Arrow</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_arrow</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">_MinRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">mProgressArcRadius</span><span class="o">,</span> <span class="n">mScaleArcRadius</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_Left</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">_MinRadius</span> <span class="o">==</span> <span class="n">mScaleArcRadius</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">_Left</span> <span class="o">=</span> <span class="n">mScaleArcRadius</span> <span class="o">-</span> <span class="n">mScaleArcWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">mArrowSpacing</span> <span class="o">-</span> <span class="n">_Arrow</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">_Left</span> <span class="o">=</span> <span class="n">mProgressArcRadius</span> <span class="o">-</span> <span class="n">mProgressArcWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">mArrowSpacing</span> <span class="o">-</span> <span class="n">_Arrow</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kt">float</span> <span class="n">_Top</span> <span class="o">=</span> <span class="o">-(</span><span class="n">_Arrow</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">_Arrow</span><span class="o">,</span> <span class="n">_Left</span><span class="o">,</span> <span class="n">_Top</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">restore</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 画文字
     * @param canvas Canvas
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawText</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">FILL</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorWhite1</span><span class="o">));</span>
        <span class="c1">//信用分数</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mCreditScoreTextSize</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">_CreditScore</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">_CreditScore</span><span class="o">);</span>
        <span class="n">Rect</span> <span class="n">_Rect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rect</span><span class="o">();</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">getTextBounds</span><span class="o">(</span><span class="n">_CreditScore</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_CreditScore</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">_Rect</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">_Y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">_CreditScore</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="c1">//信用级别</span>
        <span class="n">_Y</span> <span class="o">=</span> <span class="n">_Y</span> <span class="o">-</span> <span class="n">_Rect</span><span class="o">.</span><span class="na">height</span><span class="o">()</span> <span class="o">-</span> <span class="n">mTextSpacing</span><span class="o">;</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mCreditLevelTextSize</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">_CreditLevel</span> <span class="o">=</span> <span class="n">getCreditLevel</span><span class="o">(</span><span class="n">mCreditScore</span><span class="o">);</span>
        <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">_CreditLevel</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">getTextBounds</span><span class="o">(</span><span class="n">_CreditLevel</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_CreditLevel</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">_Rect</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">_CreditLevel</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="c1">//BETA</span>
        <span class="n">_Y</span> <span class="o">=</span> <span class="n">_Y</span> <span class="o">-</span> <span class="n">_Rect</span><span class="o">.</span><span class="na">height</span><span class="o">()</span> <span class="o">-</span> <span class="n">mTextSpacing</span><span class="o">;</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mBetaTextSize</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setAlpha</span><span class="o">(</span><span class="mi">150</span><span class="o">);</span>
        <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">BETA</span><span class="o">);</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">BETA</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
        <span class="c1">//评估时间</span>
        <span class="n">String</span> <span class="n">_EvaluationTime</span> <span class="o">=</span> <span class="n">EVALUATION_TIME</span> <span class="o">+</span> <span class="n">getDate</span><span class="o">();</span>
        <span class="n">_Width</span> <span class="o">=</span> <span class="n">mPaint</span><span class="o">.</span><span class="na">measureText</span><span class="o">(</span><span class="n">_EvaluationTime</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">getTextBounds</span><span class="o">(</span><span class="n">_EvaluationTime</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_EvaluationTime</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">_Rect</span><span class="o">);</span>
        <span class="n">mPaint</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="n">mEvaluationTimeTextSize</span><span class="o">);</span>
        <span class="n">_Y</span> <span class="o">=</span> <span class="n">mTextSpacing</span> <span class="o">+</span> <span class="n">_Rect</span><span class="o">.</span><span class="na">height</span><span class="o">();</span>
        <span class="n">canvas</span><span class="o">.</span><span class="na">drawText</span><span class="o">(</span><span class="n">_EvaluationTime</span><span class="o">,</span> <span class="o">-(</span><span class="n">_Width</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="o">),</span> <span class="n">_Y</span><span class="o">,</span> <span class="n">mPaint</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * dp转px
     * @param pContext Context
     * @param pDpVal dp值
     * @return px值
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">dp2px</span><span class="o">(</span><span class="n">Context</span> <span class="n">pContext</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pDpVal</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">_Scale</span> <span class="o">=</span> <span class="n">pContext</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getDisplayMetrics</span><span class="o">().</span><span class="na">density</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">pDpVal</span> <span class="o">*</span> <span class="n">_Scale</span> <span class="o">+</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="o">(</span><span class="n">pDpVal</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 根据信用分数计算出目标角度
     * @param pCreditScore 信用分数
     * @return 目标角度
     */</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="nf">getTargetAngle</span><span class="o">(</span><span class="kt">float</span> <span class="n">pCreditScore</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="mi">180</span> <span class="o">+</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">-</span> <span class="mi">700</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.18f</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;</span> <span class="mi">550</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="mi">45</span> <span class="o">+</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">-</span> <span class="mi">550</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.9f</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">-</span> <span class="mi">350</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.225f</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 根据信用分数获取信用级别
     * @param pCreditScore 信用分数
     * @return 信用级别
     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getCreditLevel</span><span class="o">(</span><span class="kt">int</span> <span class="n">pCreditScore</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">350</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">550</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">550</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">600</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">650</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">650</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pCreditScore</span> <span class="o">&gt;=</span> <span class="mi">700</span> <span class="o">&amp;&amp;</span> <span class="n">pCreditScore</span> <span class="o">&lt;=</span> <span class="mi">950</span><span class="o">){</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">4</span><span class="o">];</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">CREDIT_LEVEL</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 获取yyyy-MM-dd格式的日期
     * @return yyyy-MM-dd
     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">SimpleDateFormat</span> <span class="n">_DateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">_DateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="五使用">五、使用</h2>

<h4 id="一布局">（一）布局</h4>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;RelativeLayout</span>
    <span class="na">android:id=</span><span class="s">"@+id/activity_main"</span>
    <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">tools:context=</span><span class="s">"com.ce.sesamecredit.MainActivity"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;android.support.design.widget.AppBarLayout</span>
        <span class="na">android:id=</span><span class="s">"@+id/appbar_layout"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">app:elevation=</span><span class="s">"0dp"</span>
        <span class="na">android:theme=</span><span class="s">"@style/AppTheme.AppBarOverlay"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;android.support.v7.widget.Toolbar</span>
            <span class="na">android:id=</span><span class="s">"@+id/toolbar"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"?attr/actionBarSize"</span>
            <span class="na">android:background=</span><span class="s">"?attr/colorPrimary"</span>
            <span class="na">app:popupTheme=</span><span class="s">"@style/AppTheme.PopupOverlay"</span>
            <span class="na">app:navigationIcon=</span><span class="s">"@drawable/ic_arrow_back_black_24dp"</span>
            <span class="na">app:title=</span><span class="s">"芝麻信用"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/android.support.design.widget.AppBarLayout&gt;</span>
    <span class="nt">&lt;RelativeLayout</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"240dp"</span>
        <span class="na">android:layout_below=</span><span class="s">"@id/appbar_layout"</span>
        <span class="na">android:background=</span><span class="s">"@color/colorGreenBlue"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;RelativeLayout</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_marginTop=</span><span class="s">"5dp"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;com.ce.sesamecredit.DialView</span>
                <span class="na">android:id=</span><span class="s">"@+id/dialview"</span>
                <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_alignParentTop=</span><span class="s">"true"</span>
                <span class="na">android:layout_centerHorizontal=</span><span class="s">"true"</span>
                <span class="na">app:progressArcRadius=</span><span class="s">"105dp"</span>
                <span class="na">app:progressArcWidth=</span><span class="s">"1dp"</span>
                <span class="na">app:scaleArcRadius=</span><span class="s">"100dp"</span>
                <span class="na">app:scaleArcWidth=</span><span class="s">"2dp"</span>
                <span class="na">app:betaTextSize=</span><span class="s">"12dp"</span>
                <span class="na">app:creditScoreTextSize=</span><span class="s">"40dp"</span>
                <span class="na">app:creditLevelTextSize=</span><span class="s">"18dp"</span>
                <span class="na">app:evaluationTimeTextSize=</span><span class="s">"12dp"</span>
                <span class="na">app:textSpacing=</span><span class="s">"12dp"</span>
                <span class="na">app:arrowSpacing=</span><span class="s">"5dp"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;LinearLayout</span>
                <span class="na">android:layout_marginTop=</span><span class="s">"20dp"</span>
                <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_below=</span><span class="s">"@id/dialview"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;LinearLayout</span>
                    <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
                    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_weight=</span><span class="s">"1"</span>
                    <span class="na">android:gravity=</span><span class="s">"center"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">"114dp"</span>
                        <span class="na">android:layout_height=</span><span class="s">"30dp"</span>
                        <span class="na">android:layout_marginLeft=</span><span class="s">"15dp"</span>
                        <span class="na">android:background=</span><span class="s">"@drawable/textview_boundaries"</span>
                        <span class="na">android:textColor=</span><span class="s">"#EEFFFFFF"</span>
                        <span class="na">android:textAlignment=</span><span class="s">"center"</span>
                        <span class="na">android:gravity=</span><span class="s">"center"</span>
                        <span class="na">android:text=</span><span class="s">"晒晒分"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/LinearLayout&gt;</span>
                <span class="nt">&lt;LinearLayout</span>
                    <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
                    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_weight=</span><span class="s">"1"</span>
                    <span class="na">android:gravity=</span><span class="s">"center"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">"114dp"</span>
                        <span class="na">android:layout_height=</span><span class="s">"30dp"</span>
                        <span class="na">android:layout_marginRight=</span><span class="s">"15dp"</span>
                        <span class="na">android:background=</span><span class="s">"@drawable/textview_boundaries"</span>
                        <span class="na">android:textColor=</span><span class="s">"#EEFFFFFF"</span>
                        <span class="na">android:textAlignment=</span><span class="s">"center"</span>
                        <span class="na">android:gravity=</span><span class="s">"center"</span>
                        <span class="na">android:text=</span><span class="s">"了解分"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/LinearLayout&gt;</span>
            <span class="nt">&lt;/LinearLayout&gt;</span>
        <span class="nt">&lt;/RelativeLayout&gt;</span>
    <span class="nt">&lt;/RelativeLayout&gt;</span>
<span class="nt">&lt;/RelativeLayout&gt;</span>
</code></pre>
</div>

<h4 id="二activity">（二）Activity</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ce</span><span class="o">.</span><span class="na">sesamecredit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.widget.Toolbar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.Menu</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="n">Toolbar</span> <span class="n">_Toolbar</span> <span class="o">=</span> <span class="o">(</span><span class="n">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">);</span>
        <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">_Toolbar</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">getMenuInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">main_menu</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<ul>
  <li><strong><a href="https://github.com/cekiasoo/SesameCredit">源码地址</a></strong></li>
</ul>

        </article>
        <hr>

        
        
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2018/06/19/Android-Navigation-Architecture-Component/">Android Navigation Architecture Component 使用详解
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2018/04/03/AndroidAlertDialog/">Android 按 AlertDialog 的确定按钮对话框不关闭的方法
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/04/27/LeakcanaryForEclipse/">Android 在 Eclipse 项目中使用 Leakcanary 进行内存泄露检测
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/03/26/AndroidBluetoothAdapterStartDiscovery/">Android 6.0 BluetoothAdapter.startDiscovery()扫描不到蓝牙的问题分析及解决
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/03/05/CountDownTimer/">Android 倒计时 CountDownTimer 的使用和封装及改进
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2017/02/08/Android-%E5%AE%9E%E7%8E%B0%E5%BA%94%E7%94%A8%E5%86%85%E7%BD%AE%E8%AF%AD%E8%A8%80%E5%88%87%E6%8D%A2/">Android 实现应用内置语言切换
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2017/02/08/Android-%E5%AE%9E%E7%8E%B0%E5%BA%94%E7%94%A8%E5%86%85%E7%BD%AE%E8%AF%AD%E8%A8%80%E5%88%87%E6%8D%A2/">Android 实现应用内置语言切换</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2017/03/05/CountDownTimer/">Android 倒计时 CountDownTimer 的使用和封装及改进</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        





    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             来自 cekiasoo 的个人 blog！ 
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/cekiasoo" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:cekasoo@163.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>  
            <a href="http://weibo.com/u/2064454407" title="Weibo"><i class="fa fa-weibo" aria-hidden="true"></i></a>   
            <a href="https://twitter.com/cekiasoo" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>  
            <a href="https://www.facebook.com/cekiasoo" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/cekiasoo">cekiasoo</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
